<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
  <div>
    <script src="https://hml-bp-embedded-chatbot.lappis.rocks/assets/modules/channel-web/inject.js"></script>
    <script>
        let foi = false;
        let encerrar = false;
        window.botpressWebChat.init({
        host: "https://hml-bp-embedded-chatbot.lappis.rocks",
        botId: "chatbot_v2_17",
        extraStylesheet: "https://hml-bp-embedded-chatbot.lappis.rocks/assets/modules/channel-web/style.css",
        layoutWidth: "-",
        showPoweredBy: false,
        enableTranscriptDownload: false,
        enableConversationDeletion: true,
        enableReset: false,
        showConversationsButton: false,
        botName: "Brasil Participativo",
        enablePersistHistory: false});
        window.addEventListener('message', function(event) {
        try{
          if(event.data.payload){
            if(event.data.payload.text == 'Encerrar atendimento'){
              encerrar = true;
            }
          }
        } catch(error) {
        }
        if(event.data){
          if(Object.keys(event.data).length == 3 && Object.keys(event.data).includes('conversationId') && Object.keys(event.data).includes('__room') && Object.keys(event.data).includes('chatId')){
            if(encerrar){
              window.botpressWebChat.sendEvent(
                { type: 'createConversation' }
              );
              window.botpressWebChat.sendEvent({
                type: 'proactive-trigger',
                channel: 'web',
                payload: { text: 'oi' }
              });
            } else {
              console.log('entrou');
              window.botpressWebChat.sendEvent(
                { type: 'createConversation' }
              );
              window.botpressWebChat.sendEvent(
                { type: 'createConversation' }
              );
              window.botpressWebChat.sendEvent({
                type: 'proactive-trigger',
                channel: 'web',
                payload: { text: 'oi' }
              });
            }
            encerrar = false;
          }
        }
        if(!foi){
          foi = true;
          window.botpressWebChat.sendEvent(
              { type: 'show' }
            );
        }
        if (event.data && event.data.name === 'webchatReady' && foi) {
          window.botpressWebChat.sendEvent(
            { type: 'createConversation' }
          );
          window.botpressWebChat.sendEvent({
            type: 'proactive-trigger',
            channel: 'web',
            payload: { text: 'oi' }
          });
        }
        if (event.data && event.data.name === 'webchatClosed' && encerrar) {
          window.botpressWebChat.sendEvent(
            { type: 'createConversation' }
          );
          window.botpressWebChat.sendEvent({
            type: 'proactive-trigger',
            channel: 'web',
            payload: { text: 'oi' }
          });
          encerrar = false;
        }
        });
    </script>
  </div>
</body>
</html>